{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="justify-content-center popup-menu" id="popUpEdit">
    <div class="wrapper justify-content-center" style="margin-top: 21vh;">
        <div class="d-flex row content-solid card-main mx-2 justify-content-center" style="width: 350px">
            <div class="card-topic">Edit</div>
            <form id="editProfileForm" class="mt-2 px-5" enctype="multipart/form-data">
                {% csrf_token %}
                <textarea type="text" placeholder="bio" name="description">{{ profile.description }}</textarea>
                <div class=" mt-4">
                    <label for="formProfilePic" class="form-label">Profile picture</label>
                    <input class="form-control form-control-sm text-center" id="formProfilePic" type="file" name="profile_image">

                    <label for="formBgPic" class="form-label pt-3">Background picture</label>
                    <input class="form-control form-control-sm text-center" id="formBgPic" type="file" name="banner_image">
                </div>
                <button type="button" name="submit" value="edit" class="btn btn-light mt-5" style="width: 120px; font-size: 1rem;" onclick="submitEditForm();">
                    Done
                </button>
            </form>
        </div>
    </div>
</div>


<div class="justify-content-center popup-menu" id="popUpFriend">
	<div class="wrapper justify-content-center" style="margin-top: 21vh;">
		<div class="d-flex row content-solid card-main mx-2" style="width: 350px;">
			<div class="card-topic">Blocked List</div>
			<div class="chat-h-body px-4" style="height: 250px;">
				<ul class="chat-contacts">
					{% for blocked_user in blockedUsers %}
					<li class="chat-box active">
						<div class="d-flex bd-highligh align-items-center profile-content-text py-1">
							<div class="chat-image me-2">
								<img src="{{ blocked_user.profile_image.url }}" class="rounded-circle user_img">
							</div>
							<span>{{blocked_user.username}}</span>
							<!-- if block -->
							{% comment %} <button class="btn btn-outline-light btn-sm me-2 ms-auto" style=" font-size: 0.7rem;">
								<i class="bi bi-ban"></i> Block
							</button> {% endcomment %}
							<!-- else -->
							<button class="btn btn-light btn-sm me-2 ms-auto" style=" font-size: 0.7rem; color: red" onclick="unblock('{{blocked_user.username}}')" id="block_button">
								<i class="bi bi-ban"></i> Unblock
							</button>
						</div>
					</li>
					{% endfor %}
				</ul>
			</div>
			<a onclick="doneFriendManage();">
				<button type="button" class="btn btn-light mt-5" style="width: 120px; font-size: 1rem;">
					Done
				</button>
			</a>
		</div>

	</div>
</div>

<div class="container">
	<div class="row justify-content-center">
		<!-- all -->
		<div class="col-md-11">
			<div class="row justify-content-center mb-4">
				<!-- bg -->
				<div class="text-center"
					style="background-image: url('{{ profile.banner_image.url}}'); background-size: cover; height: 200px;">
				</div>
				<!-- top -->
				<div class="row profile-solid rounded-bottom py-3">
					<!-- profile pic -->
					<div class="col-md-3 mt-1 text-center">
						<img class="image-profile"
							style="width: 125px; height: 125px; margin-top: -60px; border: 5px solid #353535;"
							src='{{ profile.profile_image.url}}'>
					</div>
					<!-- profile name -->
					<div class="col-md-6 mt-1">
						<div class="profile-main-text">
							{{ profile.username }}
						</div>
						<div class="profile-label-text">{{profile.description}}</div>
					</div>
					<!-- <div class="col-md-2 mt-1">
						<div class="profile-label-text">email</div>
						<div class="profile-content-text">Email@Email</div>						
					</div>
					<div class="col-md-2 mt-1">
						<div class="profile-label-text">intra</div>
						<div class="profile-content-text">intra</div>						
					</div> -->

					<!-- Button -->
					{% url 'profile' username=user.username as user_url %}
					{% if request.path == user_url %}
					<div class="col-md-3" style="text-align: right;">
						<a onclick="showEdit();">
							<button class="btn btn-outline-light btn-sm mt-1" style=" font-size: 0.7rem;">
								<i class="bi bi-pencil-fill"></i>
								Edit
							</button>
						</a>
						<a onclick="showFriendManage();">
							<button class="btn btn-outline-light btn-sm mt-1" style=" font-size: 0.7rem;">
								<i class="bi bi-person-gear"></i>
								Manage
							</button>
						</a>
					</div>
					{% else %}
					{% if isBlocked %}
					<div class="col-md-3" style="text-align: right;">
						<div class="mt-1 text-light" style=" font-size: 0.7rem;">
							Blocked
							<i class="bi bi-ban"></i>
						</div>
					</div>
					{% elif isFriend %}
					<div class="col-md-3" style="text-align: right;">
						<div class="mt-1 text-light" style=" font-size: 0.7rem;">
							Your Friend
							<i class="bi bi-patch-check-fill"></i>
						</div>
					</div>
					{% else %}
					<div class="col-md-3" style="text-align: right;">
						<a onclick="swapApp('/users/send_friend_request/{{profile.id}}/')">
							<button class="btn btn-outline-light btn-sm mt-1" style=" font-size: 0.7rem;">
								<i class="bi bi-person-add"></i>
								Add Friend
							</button>
						</a>
					</div>
					{% endif %}
					{% endif %}

				</div>
			</div>

			<!-- 3 col -->
			<div class="row">
				<!-- match history -->
				<div class="col-md-4 p-3 profile-solid rounded mt-4">
					<div class="profile-main-text mb-4">Match History</div>
					<div class="text-center px-2" style="overflow-y: auto">
						<!-- match card -->
						{% if matchHistories %}
						{% for matchHistory in matchHistories %}
							<div class="card-match rounded p-1 mb-2">
								<div class="row">
									<div class="col-sm-4 text-start">
										<div class="profile-content-text">{{matchHistory.date_played}}</div>
										<div class="profile-label-text">{{matchHistory.game_type}}</div>
									</div>
									<div class="col-sm-8">
										<div class="d-flex justify-content-around profile-content-text">
											<p>{%if matchHistory.player1%}{{matchHistory.player1}}{%else%}guest{%endif%}</p>
											<p class="{%if matchHistory.winner == request.user.username %}win{%else%}loss{%endif%}">{{matchHistory.player1_score}} - {{matchHistory.player2_score}}</p>
											<p>{%if matchHistory.player2%}{{matchHistory.player2}}{%else%}guest{%endif%}</p>
										</div>
									</div>
								</div>
							</div>
						{% endfor %}
						{% endif %}

					</div>
				</div>
				<!-- record -->
				<div class="col-md-5 p-3 profile-solid rounded mt-4 mx-auto">
					<div class="profile-main-text mb-4">Record</div>
					<!-- content -->
					<div class="row mb-4">
						<div class="col-sm-6" id="bsb-chart-7"></div>
						<div class="col-sm-6 my-2 profile-content-text">
							<div class="profile-main-text my-2" style="font-size: 0.9rem;">Win percentage 25%</div>
							Gmaeplayed 4<br>
							Win 1<br>
							Draws 1<br>
							Losses 2
						</div>
					</div>
					<!-- progress bar -->
					<div class="row mb-2">
						<div class="col-6 profile-label-text text-start">Goals Conceded 0</div>
						<div class="col-6 profile-label-text text-end">Goals Scored 0</div>
					</div>
					<div class="progress" style="border: 2px solid #b3b3b3;">
						<div class="progress-bar bg-light" role="progressbar" style="width: 75%" aria-valuenow="30"
							aria-valuemin="0" aria-valuemax="100"></div>
						<div class="progress-bar bg-dark" role="progressbar" style="width: 25%" aria-valuenow="20"
							aria-valuemin="0" aria-valuemax="100"></div>
					</div>
					<div class="text-center profile-content-text my-3">Difference -5</div>

				</div>

				<!-- friends -->
				<div class="col-md-2 p-3 profile-solid rounded mt-4">
					<div class="profile-main-text">Friends</div>
					<div style="overflow-y: auto">
						{% if request.path == user_url %}
						<div class="profile-label-text mt-3">ONLINE - {{ online }}</div>
						<ul class="chat-contacts">
							{% for friend in allFriend %}
							{% if friend.active %}
							<a onclick="swapApp('/users/{{ friend.username }}')" class="profile-content-text"
								style="text-decoration: none; color: #fff;">
								<li style="margin-bottom: 0px;">
									<div class="d-flex align-items-center profile-content-text py-1">
										<div class="chat-image">
											<img src="{{ friend.profile_image.url}}" class="rounded-circle user_img">
											<span class="online_icon"></span>
										</div>
										<div class="px-2">
											{{ friend.username }}
										</div>
									</div>
								</li>
							</a>
							{% endif %}
							{% endfor %}
						</ul>
						<div class="profile-label-text">OFFLINE - {{ offline }}</div>
						<ul class="chat-contacts">
							{% for friend in allFriend %}
							{% if not friend.active %}
							<a onclick="swapApp('/users/{{ friend.username }}')" class="profile-content-text"
								style="text-decoration: none; color: #fff;">
								<li style="margin-bottom: 0px;">
									<div class="d-flex align-items-center profile-content-text py-1">
										<div class="chat-image">
											<img src="{{ friend.profile_image.url}}" class="rounded-circle user_img">
											<span class="online_icon offline"></span>
										</div>
										<div class="px-2">
											{{ friend.username }}
										</div>
									</div>
								</li>
							</a>
							{% endif %}
							{% endfor %}
						</ul>
						{% endif %}
						{% if request.path != user_url %}
						<ul class="chat-contacts">
							{% for friend in allFriend %}
							<a onclick="swapApp('/users/{{ friend.username }}')" class="profile-content-text"
								style="text-decoration: none; color: #fff;">
								<li style="margin-bottom: 0px;">
									<div class="d-flex align-items-center profile-content-text py-1">
										<div class="chat-image">
											<img src="{{ friend.profile_image.url}}" class="rounded-circle user_img">
										</div>
										<div class="px-2">
											{{ friend.username }}
										</div>
									</div>
								</li>
							</a>
							{% endfor %}
						</ul>
						{% endif %}

					</div>
				</div>
			</div>
		</div>
	</div>
</div>

{% endblock %}