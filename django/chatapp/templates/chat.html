{% extends 'base.html' %}

{% block site_title %}Chat Page{% endblock %}

{% block script %}
<script>
	const chatSocket = new WebSocket('ws:://' + window.location.host + '/ws/chat/');

	chatSocket.onmessage = function(e) {
		const data = JSON.parse(e.data);
		const message = data['message'];
		// Handle incoming message
	};

	chatSocket.onclose = function(e) {
		console.error('Chat socket closed unexpectly');
	};

	// Send message to server
	function sendMessage(message) {
		chatSocket.send(JSON.stringify({
			'message' : message
		}));
	};
</script>
{% endblock %}

{% block content %}


<div class="container pt-3">

	<div class="row">
		<!-- friend chat -->
		<div class="col content-friend px-4 py-4 mx-1 mt-2" style="height: 90vh;">
			<div class="profile-main-text text-center mb-3">Chat</div>
			<!-- search -->
			<form action="#" class="pb-3">
				<input type="text" placeholder="search" style="width: 80%; background-color: #c4c4c4;">
				<button class="btn btn-outline-light" type="submit" style="border-radius: 15px;"><i class="bi bi-search"></i></button>
			</form>
			<!-- friend chat -->
			<div class="chat-h-body h-75">
				<ui class="chat-contacts">
					<li class="chat-box active">
						<div class="d-flex bd-highligh align-items-center profile-content-text py-1">
							<div class="chat-image">
								<img src="https://static.displate.com/280x392/displate/2023-02-24/fcd5dd8ccf8d7a90a8040f55dc916125_7aae96bbc41922030f842aee835b0f5a.jpg" class="rounded-circle user_img">
								<span class="online_icon"></span>
							</div>
							<div class="px-2">
								<span>User</span><br>
								<span class="profile-label-text">last text</span>
							</div>
							<div class="px-2 align-items-end ms-auto">
								<p>00:00</p>
							</div>
						</div>
					</li>
					<li class="chat-box">
						<div class="d-flex bd-highligh align-items-center profile-content-text py-1">
							<div class="chat-image">
								<img src="https://static.displate.com/280x392/displate/2023-02-24/fcd5dd8ccf8d7a90a8040f55dc916125_7aae96bbc41922030f842aee835b0f5a.jpg" class="rounded-circle user_img">
								<span class="online_icon offline"></span>
							</div>
							<div class="px-2">
								<span>User</span><br>
								<span class="profile-label-text">last text</span>
							</div>
							<div class="px-2 align-items-end ms-auto">
								<p>00:00</p>
							</div>
						</div>
					</li>
					<li class="chat-box">
						<div class="d-flex bd-highligh align-items-center profile-content-text py-1">
							<div class="chat-image">
								<img src="https://static.displate.com/280x392/displate/2023-02-24/fcd5dd8ccf8d7a90a8040f55dc916125_7aae96bbc41922030f842aee835b0f5a.jpg" class="rounded-circle user_img">
								<span class="online_icon offline"></span>
							</div>
							<div class="px-2">
								<span>User</span><br>
								<span class="profile-label-text">last text</span>
							</div>
							<div class="px-2 align-items-end ms-auto">
								<p>00:00</p>
							</div>
						</div>
					</li>
					<li class="chat-box">
						<div class="d-flex bd-highligh align-items-center profile-content-text py-1">
							<div class="chat-image">
								<img src="https://static.displate.com/280x392/displate/2023-02-24/fcd5dd8ccf8d7a90a8040f55dc916125_7aae96bbc41922030f842aee835b0f5a.jpg" class="rounded-circle user_img">
								<span class="online_icon offline"></span>
							</div>
							<div class="px-2">
								<span>User</span><br>
								<span class="profile-label-text">last text</span>
							</div>
							<div class="px-2 align-items-end ms-auto">
								<p>00:00</p>
							</div>
						</div>
					</li>
					<li class="chat-box">
						<div class="d-flex bd-highligh align-items-center profile-content-text py-1">
							<div class="chat-image">
								<img src="https://static.displate.com/280x392/displate/2023-02-24/fcd5dd8ccf8d7a90a8040f55dc916125_7aae96bbc41922030f842aee835b0f5a.jpg" class="rounded-circle user_img">
								<span class="online_icon offline"></span>
							</div>
							<div class="px-2">
								<span>User</span><br>
								<span class="profile-label-text">last text</span>
							</div>
							<div class="px-2 align-items-end ms-auto">
								<p>00:00</p>
							</div>
						</div>
					</li>
					<li class="chat-box">
						<div class="d-flex bd-highligh align-items-center profile-content-text py-1">
							<div class="chat-image">
								<img src="https://static.displate.com/280x392/displate/2023-02-24/fcd5dd8ccf8d7a90a8040f55dc916125_7aae96bbc41922030f842aee835b0f5a.jpg" class="rounded-circle user_img">
								<span class="online_icon offline"></span>
							</div>
							<div class="px-2">
								<span>User</span><br>
								<span class="profile-label-text">last text</span>
							</div>
							<div class="px-2 align-items-end ms-auto">
								<p>00:00</p>
							</div>
						</div>
					</li>
					<li class="chat-box">
						<div class="d-flex bd-highligh align-items-center profile-content-text py-1">
							<div class="chat-image">
								<img src="https://static.displate.com/280x392/displate/2023-02-24/fcd5dd8ccf8d7a90a8040f55dc916125_7aae96bbc41922030f842aee835b0f5a.jpg" class="rounded-circle user_img">
								<span class="online_icon offline"></span>
							</div>
							<div class="px-2">
								<span>User</span><br>
								<span class="profile-label-text">last text</span>
							</div>
							<div class="px-2 align-items-end ms-auto">
								<p>00:00</p>
							</div>
						</div>
					</li>
					<li class="chat-box">
						<div class="d-flex bd-highligh align-items-center profile-content-text py-1">
							<div class="chat-image">
								<img src="https://static.displate.com/280x392/displate/2023-02-24/fcd5dd8ccf8d7a90a8040f55dc916125_7aae96bbc41922030f842aee835b0f5a.jpg" class="rounded-circle user_img">
								<span class="online_icon offline"></span>
							</div>
							<div class="px-2">
								<span>User</span><br>
								<span class="profile-label-text">last text</span>
							</div>
							<div class="px-2 align-items-end ms-auto">
								<p>00:00</p>
							</div>
						</div>
					</li>
					<li class="chat-box">
						<div class="d-flex bd-highligh align-items-center profile-content-text py-1">
							<div class="chat-image">
								<img src="https://static.displate.com/280x392/displate/2023-02-24/fcd5dd8ccf8d7a90a8040f55dc916125_7aae96bbc41922030f842aee835b0f5a.jpg" class="rounded-circle user_img">
								<span class="online_icon offline"></span>
							</div>
							<div class="px-2">
								<span>User</span><br>
								<span class="profile-label-text">last text</span>
							</div>
							<div class="px-2 align-items-end ms-auto">
								<p>00:00</p>
							</div>
						</div>
					</li>
					<li class="chat-box">
						<div class="d-flex bd-highligh align-items-center profile-content-text py-1">
							<div class="chat-image">
								<img src="https://static.displate.com/280x392/displate/2023-02-24/fcd5dd8ccf8d7a90a8040f55dc916125_7aae96bbc41922030f842aee835b0f5a.jpg" class="rounded-circle user_img">
								<span class="online_icon offline"></span>
							</div>
							<div class="px-2">
								<span>User</span><br>
								<span class="profile-label-text">last text</span>
							</div>
							<div class="px-2 align-items-end ms-auto">
								<p>00:00</p>
							</div>
						</div>
					</li>
				</ui>
			</div>
		</div>

		<!-- main -->
		<div class="col-md-9 content-friend px-4 py-4 mx-1 mt-2 pb-5">
			<!-- chat header -->
			<div class="d-flex">
				<div class="profile-main-text me-auto"> (Name) </div>

				<button class="btn btn-light btn-sm me-2" style=" font-size: 0.7rem;">
					<i class="bi bi-joystick"></i> invite
				</button>
				<button class="btn btn-light btn-sm me-2" style=" font-size: 0.7rem;">
					<i class="bi bi-person-fill"></i> profile
				</button>
			</div>

			<!-- message -->
			<div class="p-4 chat-h-body" style="color: #ececec; height: 95%;">

				<!-- friend -->
				<div class="d-flex justify-content-start mb-4">
					<div class="chat-image">
						<img src="https://static.displate.com/280x392/displate/2023-02-24/fcd5dd8ccf8d7a90a8040f55dc916125_7aae96bbc41922030f842aee835b0f5a.jpg" class="rounded-circle user_img">
					</div>
					<div class="d-flex flex-column ps-2">
						<span>
							Hello, how are you?
						</span>
						<span class="profile-label-text">
							8:40 AM, Today
						</span>
					</div>
				</div>
				
				<!-- user -->
				<div class="d-flex justify-content-end mb-4">
					<div class="d-flex flex-column pe-2">
						<span>
							Good, What about you?
						</span>
						<span class="profile-label-text">
							8:55 AM, Today
						</span>
					</div>
					<div class="chat-image">
						<img src="https://static.displate.com/280x392/displate/2023-02-24/fcd5dd8ccf8d7a90a8040f55dc916125_7aae96bbc41922030f842aee835b0f5a.jpg" class="rounded-circle user_img">
					</div>
				
				</div>
			</div>

			<!-- text box -->
			<div>
				<form action="#" >
					<input type="text" placeholder="Type your message" style="width: 90%; background-color: #c4c4c4;">
					<button class="btn btn-dark rounded">Send</button>
				</form>
			</div>

		</div>

	</div>

</div>



<!-- <div>
      {% for room in rooms %}
	  <a href="{{room.slug}}">{{ room.name }}</a>
	  {% endfor %}
</div> -->



<script>
	const chatSocket = new WebSocket("ws://" + window.location.host + "/");
	chatSocket.onopen = function (e) {
		console.log("The connection was setup successfully !");
	};
	chatSocket.onclose = function (e) {
		console.log("Something unexpected happened !");
	};
	document.querySelector("#id_message_send_input").focus();
	document.querySelector("#id_message_send_input").onkeyup = function (e) {
		if (e.keyCode == 13) {
			document.querySelector("#id_message_send_button").click();
		}
	};
	document.querySelector("#id_message_send_button").onclick = function (e) {
		var messageInput = document.querySelector(
			"#id_message_send_input"
		).value;
		chatSocket.send(JSON.stringify({ message: messageInput, username : "{{request.user.username}}"}));
	};
	chatSocket.onmessage = function (e) {
		const data = JSON.parse(e.data);
		var div = document.createElement("div");
		div.innerHTML = data.username + " : " + data.message;
		document.querySelector("#id_message_send_input").value = "";
		document.querySelector("#id_chat_item_container").appendChild(div);
	};
</script>
{% endblock %}